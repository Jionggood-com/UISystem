var userAgent=navigator.userAgent.toLowerCase();var itemboxX=$(".itembox").offset().left;var itemboxY=$(".itembox").offset().top;jQuery.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)};function msgTipsbox(i,j,k,l,m,n,t){modal_bg();if(t==''){t='';} else{t="<div class='modal_title'>"+t+"<i onclick='modal_remove();'>×</i></div>";} $('.modal_container').append("<div class='modal_msgbox'>"+t+"<div class='modal_msgbox_msg'>"+j+"</div><div class='modal_msgbox_button'></div></div>");if(i==0)$('.modal_container .modal_msgbox_button').append("<span class='button_ok' onclick='modal_remove();'><i>OK</i></span>");if(i==1) {$('.modal_container .modal_msgbox_button').append("<span class='button_no' onclick='modal_remove();'><i>Cancel</i></span><span class='button_yes'><i>Yes</i></span>");$(document).off("click",".button_yes").on("click",".button_yes",function(){k(l);});} if(i==2) {$('.modal_container .modal_msgbox_button').append("<span class='button_yes'><i>"+m+"</i></span><span class='button_no' onclick='modal_remove();'><i>"+n+"</i></span>");$(document).off("click",".button_yes").on("click",".button_yes",function(l){if(i)k(l);});} modal_add();};$(document).on("click",".inputbox",function(){$(this).find(".tips").hide(200,function(){$(this).find(".tips").remove();});});(function($){$.UiOperateItem={_create:function(o){var o=$(o);var html=''+'<div class="create_col">'+'<input type="text" name="itemname" class="inputchange" dvaule="新建" placeholder="输入名称">'+'<input type="hidden" name="col" value="0">'+'<input type="hidden" name="row" value="0">'+'<ul class="xy inputbox" msg="请选择其中一个"><li><span><i></i></span>X轴</li><li><span><i></i></span>Y轴</li></ul>'+'</div>';msgTipsbox(2,html,function(re){if(re){confirmCreate();}},'','确定','取消','');},chooseXY:function(o){o.parent().find("span").removeClass("active");o.find("span").addClass("active");if(o.index()==0) {$('input[name="col"]').val(1);$('input[name="row"]').val(0);} else {$('input[name="col"]').val(0);$('input[name="row"]').val(1);}},editY:function(o){var val=o.prev().text();var html=''+'<div class="create_col">'+'<input type="text" name="itemname" class="inputchange" value='+val+' dvaule="新建" placeholder="输入名称">'+'</div>';msgTipsbox(2,html,function(re){if(re){confirmeditY(o);}},'','确定','取消','');},removeY:function(o){msgTipsbox(2,'你确定要删除？',function(re){if(re){confirmremoveY(o);}},'','确定','取消','');},editX:function(o){var val=o.siblings(".name").text();var html=''+'<div class="create_col">'+'<input type="text" name="itemname" class="inputchange" value='+val+' dvaule="新建" placeholder="输入名称">'+'</div>';msgTipsbox(2,html,function(re){if(re){confirmeditX(o);}},'','确定','取消','');},removeX:function(o){msgTipsbox(2,'你确定要删除？',function(re){if(re){confirmremoveX(o);}},'','确定','取消','');},toolTags:function(o){o.addClass("active").siblings().removeClass("active");var tags_id=$(".tool_tags li.active").attr("data-id");$("input[name='tagsNumber']").val(tags_id);$('.checkline').children().attr("stroke","#336699");$(".o_line").remove();},eidtElement:function(o){o.hide();o.next().hide();var val=o.prev().text();var textarea=o.parent().next().text();var textareaItem='<textarea name="description" maxlength="100"  placeholder="输入内容">'+textarea+'</textarea>';if(o.parents(".model_item").hasClass("model_choose")) {textareaItem='';} var html=''+'<div class="create_col">'+'<input type="text" name="itemname" class="inputchange" value='+val+' dvaule="新建" placeholder="输入名称">'+ textareaItem+'</div>';msgTipsbox(2,html,function(re){if(re){confirmeidtElement(o);}},'','确定','取消','');},removeElement:function(o){msgTipsbox(2,'你确定要删除这个模块？',function(re){if(re){confirmremoveElement(o);}},'','确定','取消','');},showElementPoa:function(o){o.find("h4 big,h4 i").toggle();$('.checkline').children().attr("stroke","#336699");$(".o_line").remove();},rowDrag:function(o){o.find('.line').toggle();o.siblings().find('.line').hide();},colDrag:function(o){o.find('.line').toggle();o.siblings().find('.line').hide();}}})(jQuery);$(document).on("click",".ui_item .add_section i",function(){$.UiOperateItem._create($(this));}).on("click",".create_col .xy li",function(){$.UiOperateItem.chooseXY($(this));}).on("click",".ui_item .col li big",function(){$.UiOperateItem.editY($(this));}).on("click",".ui_item .col li small",function(){$.UiOperateItem.removeY($(this));}).on("click",".ui_item .row li big",function(){$.UiOperateItem.editX($(this));}).on("click",".ui_item .row li u",function(){$.UiOperateItem.removeX($(this));}).on("click",".tool_tags li",function(){$.UiOperateItem.toolTags($(this));}).on("click",".itembox .model h4 i",function(){$.UiOperateItem.removeElement($(this));}).on("click",".itembox .model h4 big",function(){$.UiOperateItem.eidtElement($(this));}).on("dblclick",".model",function(){$.UiOperateItem.showElementPoa($(this));}).on("dblclick",".ui_item .row li",function(){$.UiOperateItem.rowDrag($(this));}).on("dblclick",".ui_item .col li",function(){$.UiOperateItem.colDrag($(this));});function confirmCreate(){if($(".create_col").parent().next().find(".button_yes").hasClass("loading"))return;$(".create_col .xy").find(".tips").remove();var val=$('input[name="itemname"]').val();var dvalue=$('input[name="itemname"]').attr("dvaule");var colVal=$('input[name="col"]').val();var rowVal=$('input[name="row"]').val();var msg=$(".create_col .xy").attr("msg");if(colVal==0&&rowVal==0) {$(".create_col .xy").append('<div class="tips"><i></i>'+msg+'</div>');return false;} if(val==''){val=dvalue;} $(".create_col").parent().next().find(".button_yes").addClass("loading");if(rowVal==1&&colVal==0){setTimeout(function(){$(".ui_item .col ul").append('<li><span class="name">'+val+'</span><big>编辑</big><small>删除</small><b class="line"></b></li>');modal_remove();},2000);} if(colVal==1&&rowVal==0){setTimeout(function(){$(".ui_item .row ul").append('<li><span class="name">'+val+'</span><u>删除</u><big>编辑</big><small>'+(parseInt($(".ui_item .row li:last-child").find("small").text())+1)+'</small><i class="arrow_d"><i><i></i></i></i><b class="line"></b></li>');modal_remove();},2000);} setTimeout(function(){createUI();initLocation();},2200);} function confirmeditY(obj){var o=$(obj);var msg=$(".create_col .xy").attr("msg");var val=$('input[name="itemname"]').val();var dvalue=$('input[name="itemname"]').attr("dvaule");if(!val){val=dvalue;} $(".create_col").parent().next().find(".button_yes").addClass("loading");setTimeout(function(){o.siblings(".name").text(val);modal_remove();},2000);setTimeout(function(){createUI();},2200);} function confirmremoveY(obj){var o=$(obj);$(".modal_msgbox .button_yes").addClass("loading");setTimeout(function(){o.parent().remove();modal_remove();},2000);setTimeout(function(){createUI();},2200);} function confirmeditX(obj){var o=$(obj);var msg=$(".create_col .xy").attr("msg");var val=$('input[name="itemname"]').val();var dvalue=$('input[name="itemname"]').attr("dvaule");if(!val){val=dvalue;} $(".create_col").parent().next().find(".button_yes").addClass("loading");setTimeout(function(){o.siblings(".name").text(val);modal_remove();},2000);setTimeout(function(){createUI();},2200);} function confirmremoveX(obj){var o=$(obj);$(".modal_msgbox .button_yes").addClass("loading");setTimeout(function(){o.parent().remove();modal_remove();},2000);setTimeout(function(){createUI();},2200);} function confirmeidtElement(obj){var o=$(obj);$(".modal_msgbox .button_yes").addClass("loading");var val=$('input[name="itemname"]').val();var dvalue=$('input[name="itemname"]').attr("dvaule");var textarea=$('textarea[name="description"]').val();if(!val){val=dvalue;} $(".create_col").parent().next().find(".button_yes").addClass("loading");setTimeout(function(){o.prev().text(val);if(!o.parents(".model_item").hasClass("model_choose")){o.parent().next().remove();if(textarea!='') {o.parent().after('<em>'+textarea+'</em>');}} modal_remove();},2000);} function confirmremoveElement(obj){var o=$(obj);var modelNum=$("#modelNum").val();var coordinate=o.parents(".model").attr('new');$(".modal_msgbox .button_yes").addClass("loading");setTimeout(function(){$(".checkline").each(function(){var from=$(this).children().attr('from');var to=$(this).children().attr('to');if(coordinate==from||coordinate==to) {$(this).remove();}});o.parents(".model").remove();modal_remove();modelNum-=1;$("#modelNum").val(modelNum);},2000);} function removePath(obj){var chartPath=$("#chartPath").val();var o=$(obj);var id=o.parent().attr("data-id");$("#graph_table").find('#'+id).remove();o.parent().remove();chartPath-=1;$("#chartPath").val(chartPath);} function initLocation(){var keyword_Input;$(".ui_item .col .line").draggable({axis:"y"});$(".ui_item .row .line").draggable({axis:"x"});$(".ui_item .col .line,.ui_item .row .line").mousedown(function(){$(this).css("cursor","move");});$(".ui_item .col .line").mousemove(function(){$(this).css("cursor","n-resize");var o=$(this);o.one("mouseup",function(){var height=parseInt(o.css('top'));var nameHeight=parseInt($(this).siblings('.name').outerHeight());var paddingTop=parseInt(o.parent().css("paddingTop"));$(this).parent().css('height',height);var sum=0;for(var i=0;i<$(this).parents(".col").find("li").length;i++) {sum+=parseInt($(this).parents(".col").find("li").eq(i).outerHeight());} $(this).parents("ul").css("min-height",sum);$(this).parents(".ui_item").css("min-height",sum+100);clearTimeout(keyword_Input);keyword_Input=setTimeout(function(){createUI();},100);$(this).siblings('.name').css('margin-top',(height-paddingTop*2-nameHeight)/2);});});$(".ui_item .row .line").mousemove(function(){$(this).css("cursor","e-resize");var o=$(this);o.one("mouseup",function(){var width=$(this).css('left');$(this).parent().css('width',width);var rowNum=0;for(var i=0;i<$(this).parents(".row").find("li").length;i++) {rowNum+=parseInt($(this).parents(".row").find("li").eq(i).outerWidth());} $(this).parents("ul").css("min-width",rowNum);$(this).parents(".ui_item").css("min-width",rowNum+100);clearTimeout(keyword_Input);keyword_Input=setTimeout(function(){createUI();},100);});});$(".model,.cover").each(function(){$(this).draggable({containment:"parent"});});$(".model").mousedown(function(){$(this).css("cursor","move");});$(".model").mouseup(function(){if($("#graph_table").find(".checkline").length==0)return;var o=$(this);var differencex=$(this).attr("differencex");var differencey=$(this).attr("differencey");var chooseID=$(".tool_tags li.active").attr("data-id");if(chooseID==1)return;var x=parseInt($(this).css("left"));var y=parseInt($(this).css("top"));var movex=parseInt(x)+parseInt(differencex);var movey=parseInt(y)+parseInt(differencey);o.attr('new',movex+','+movey);_from=o.attr("old");$(".checkline").each(function(){var pathFrom=$(this).children().attr("from");var pathTo=$(this).children().attr("to");var strTo=pathTo.replace(/,/," ");var strFrom=pathFrom.replace(/,/," ");var firstFromStr=pathFrom.split(",");var lastToStr=pathTo.split(",");var dpath=$(this).attr("d");if(_from==pathFrom) {$(this).children().attr({"d":'M '+movex+' '+movey+' L '+movex+' '+lastToStr[1]+' L '+strTo});$(this).children().attr('from',movex+','+movey);} if(_from==pathTo) {$(this).children().attr({"d":'M '+strFrom+' L '+firstFromStr[0]+' '+movey+' L '+movex+' '+movey});$(this).children().attr('to',movex+','+movey);} o.attr('old',movex+','+movey);});var movexy=o.attr("new");o.attr("old",movexy);});} $(document).on("click","#graph_table",function(event){var num=parseInt($("#modelNum").val());var chooseID=parseInt($("input[name='tagsNumber']").val());if(chooseID==0)return;if(!$(event.target).parents("#graph_table").length>0) {var x=event.pageX;var y=event.pageY;var html_2=''+'<div id="model_'+num+'" class="model adapter" style="top:'+(y-itemboxY)+'px;left:'+(x-itemboxX)+'px;">'+'<div class="model_item">'+'<h4><span>模块标题</span><big>编辑</big><i>×</i></h4>'+'<em>模块描述</em>'+'</div>'+'</div>';var html_3=''+'<div id="model_'+num+'" class="model adapter" style="top:'+(y-itemboxY)+'px;left:'+(x-itemboxX)+'px;">'+'<div class="model_item model_choose">'+'<h4><span>判断条件</span><big>编辑</big><i>×</i></h4>'+'</div>'+'</div>';var html_4=''+'<div class="model" style="top:'+(y-itemboxY)+'px;left:'+(x-itemboxX)+'px;">'+'<div class="model_item model_yes">'+'<h4><span>是</span><i>×</i></h4>'+'</div>'+'</div>';var html_5=''+'<div class="model" style="top:'+(y-itemboxY)+'px;left:'+(x-itemboxX)+'px;">'+'<div class="model_item model_no">'+'<h4><span>否</span><i>×</i></h4>'+'</div>'+'</div>';if(chooseID==2){$(".itembox").append(html_2);num+=1;} if(chooseID==3){$(".itembox").append(html_3);num+=1;} if(chooseID==4){$(".itembox").append(html_4);} if(chooseID==5){$(".itembox").append(html_5);} if(chooseID>1){initLocation();} $("#modelNum").val(num);$(".tool_tags li").removeClass("active");$("input[name='tagsNumber']").val(0);}});$(document).on("mouseenter","#graph_table",function(event){var n=parseInt($("#chartPath").val());var chooseID=parseInt($("input[name='tagsNumber']").val());if(!$(event.target).parents("#graph_table").length>0&&$(".itembox .adapter").length>1){if(chooseID==1){$(document).find(".adapter").mouseleave(function(){var _this=$(this);setTimeout(function(){_this.removeClass("draw");},500);});$(document).find(".adapter").mouseenter(function(){if(chooseID==0)return;$(this).addClass("draw");var modelID=$(this).attr("id");if($(".tool_tags li.active").length>0){if($('#draw_'+modelID).length==0) {if(!$(this).siblings(".cover").hasClass("move")) {$(".itembox").append('<div id="draw_'+modelID+'" class="cover" style="width:'+$(this).outerWidth()+';height:'+$(this).outerHeight()+';left:'+$(this).css("left")+';top:'+$(this).css("top")+';" />');initLocation();}}} $(document).find('#draw_'+$(this).attr("id")).one("mousedown",function(){$(this).siblings(".cover").remove();var _this=$(this);$(this).css({"cursor":"crosshair","z-index":"0"});var drawX=parseInt($(this).css("left"));var drawY=parseInt($(this).css("top"));var lineX=drawX+parseInt($(this).outerWidth()/2);var lineY=drawY+parseInt($(this).outerHeight()/2);var drawID=$(this).attr("id").replace(/draw_/,"");$('#'+drawID).attr({'new':lineX+','+lineY,'old':lineX+','+lineY,'differenceX':lineX-drawX,'differenceY':lineY-drawY});_this.mousemove(function(event){if(!$(".tool_tags li").hasClass("active"))return;$(this).addClass("move");var a=parseInt(event.clientX-itemboxX);var b=parseInt(event.clientY-itemboxY);var colM='M '+(lineX)+' '+(lineY)+' L '+a+' '+b;var svgline=makeSVG('g',{'id':'line_'+n,'class':'checkline','zIndex':'1','style':'cursor:pointer'});var linePath=makeSVG('path',{'id':'path_'+n,'class':drawID,'d':colM,stroke:'#ff6600','stroke-width':1,'stroke-dasharray':'4,3',fill:'none','zIndex':1,'marker-end':'url(#arrow1)'});if($("#graph_table #line_"+n).length==0) {document.getElementById('graph_table').appendChild(svgline);document.getElementById('line_'+n).appendChild(linePath);} else{document.getElementById('path_'+n).setAttribute("d",colM);} linePath.onmousedown=function(event){$('.checkline').children().attr("stroke","#336699");$(".o_line").remove();$(this).attr("stroke","#ff3300");var lineID=$(this).parent().attr("id");var lx=parseInt(event.clientX-itemboxX)+10;var ly=parseInt(event.clientY-itemboxY)+10;$(".itembox").append('<div style="position:absolute;top:'+ly+'px;left:'+lx+'px;" data-id="'+lineID+'" class="o_line"><i onclick="removePath(this)" class="removeline"></i><i onclick="verticalPath(this)" class="verticalline"></i><i onclick="levelline(this)" class="levelline"></i><i onclick="beeline(this)" class="beeline"></i></div>');};});$(document).one("mouseup",function(){var hasTo=modelID+','+$(".draw").attr("id");var gLength=$("#graph_table").children().length;if(chooseID==0)return;var ss=modelID+','+$(".draw").attr("id");var c=parseInt($(".draw").css("left"))+parseInt($(".draw").outerWidth()/2);var d=parseInt($(".draw").css("top"))+parseInt($(".draw").outerHeight()/2);$(".draw").attr({"new":c+','+d,"old":c+','+d,'differenceX':c-parseInt($(".draw").css("left")),'differenceY':d-parseInt($(".draw").css("top"))});var colM='M '+(lineX)+' '+(lineY)+' L '+(lineX)+' '+d+' L '+c+' '+d;var elementId=document.getElementById('path_'+n);if(elementId!=null) {document.getElementById('path_'+n).setAttribute("d",colM);document.getElementById('path_'+n).setAttribute("stroke",'#336699');document.getElementById('path_'+n).setAttribute("stroke-dasharray",'');document.getElementById('line_'+n).setAttribute("target",modelID+','+$(".draw").attr("id"));document.getElementById('path_'+n).setAttribute("from",lineX+','+lineY);document.getElementById('path_'+n).setAttribute("to",c+','+d);} $(".checkline").each(function(){var targetStr=$(this).attr("target");if(targetStr==undefined){$(this).remove();return false;} else {if(targetStr.indexOf('undefined')>-1){$(this).remove();}}});var lasttargetStr=$(".checkline:last").attr("target");$(".checkline:not(':last')").each(function(){var targetStr=$(this).attr("target");if(lasttargetStr==targetStr){$(".checkline:last").css('background','red');$(".checkline:last").remove();}});$(".cover").remove();chooseID=0;initLocation();n+=1;$("#chartPath").val(n);$("input[name='tagsNumber']").val(0);});});});$(document).mouseup(function(){$(".tool_tags li").removeClass("active");$(".cover").remove();});}}}); ;function makeSVG(tag, attrs) { 	var el= document.createElementNS('http://www.w3.org/2000/svg', tag); 	for (var k in attrs) 		el.setAttribute(k, attrs[k]); 	return el; }  function createUI(){ 	var itemWidth = $(".ui_item").outerWidth(); 	var itemheight = $(".ui_item").outerHeight(); 	$("#graph_table #col,#graph_table #row").empty(); 	var colLI = $(".ui_item .col li"); 	var rowLI = $(".ui_item .row li"); 	var colLength = colLI.length; 	var rowLength = rowLI.length; 	var svgCol= makeSVG('g', {'id': 'col','zIndex':'1'}); 	var svgRow= makeSVG('g', {'id': 'row','zIndex':'1'}); 	var defs = makeSVG('defs', {'id': 'svgArrow'}); 	var arrow_1 = makeSVG('marker', {'id': 'arrow1','viewBox':'0 0 6 6', 'refX':'5', 'refY':'3','markerUnits':'strokeWidth', 'markerWidth':'6', 'markerHeight':'6', 'orient':'auto'}); 	var pathArrow_1 = makeSVG('path', {'d': 'M 0 0 L 6 3 L 0 6 z','fill':'#336699', 'stroke-width':'0'}); 	var arrow_2 = makeSVG('marker', {'id': 'arrow2','viewBox':'0 0 6 6', 'refX':'5', 'refY':'3','markerUnits':'strokeWidth', 'markerWidth':'6', 'markerHeight':'6', 'orient':'auto'}); 	var pathArrow_2 = makeSVG('path', {'d': 'M 0 0 L 6 3 L 0 6 z','fill':'#ff660', 'stroke-width':'0'}); 	 	if($("#graph_table #col,#graph_table #row").length==0) 	{ 		document.getElementById('graph_table').appendChild(defs); 		document.getElementById('svgArrow').appendChild(arrow_1); 		document.getElementById('svgArrow').appendChild(arrow_2); 		document.getElementById('arrow1').appendChild(pathArrow_1); 		document.getElementById('arrow2').appendChild(pathArrow_2); 		document.getElementById('graph_table').appendChild(svgCol); 		document.getElementById('graph_table').appendChild(svgRow); 	} 	 	 	var colSum = 0; 	for(var i=0;i<colLength;i++){ 		colSum += colLI.eq(i).outerHeight();  		var colM = 'M 0 '+(colSum-0.5)+' L '+ itemWidth+ ' '+ (colSum-0.5); 		var colPath= makeSVG('path', {'d': colM, stroke: '#dddddd', 'stroke-width': 1, fill: 'none','zIndex':1, 'opacity':1}); 		document.getElementById('col').appendChild(colPath); 	} 	 	var rowSum = 0; 	for(var i=0;i<rowLength;i++){ 		rowSum += rowLI.eq(i).outerWidth();  		var rowM = 'M '+(rowSum-0.5)+' 0 L '+ (rowSum-0.5)+ ' '+ itemheight; 		var rowPath= makeSVG('path', {'d': rowM, stroke: '#999999', 'stroke-width': 1, fill: 'none','zIndex':1, 'opacity':1,'stroke-dasharray':'4,3'}); 		document.getElementById('row').appendChild(rowPath); 	} } createUI(); ;(function(C){C.ui=C.ui||{};C.extend(C.ui,{plugin:{add:function(E,F,H){var G=C.ui[E].prototype;for(var D in H){G.plugins[D]=G.plugins[D]||[];G.plugins[D].push([F,H[D]])}},call:function(D,E,G){var H=D.plugins[E];if(!H){return }for(var F=0;F<H.length;F++){if(D.options[H[F][0]]){H[F][1].apply(D.element,G)}}}},cssCache:{},css:function(D){if(C.ui.cssCache[D]){return C.ui.cssCache[D]}var E=C('<div class="ui-resizable-gen">').addClass(D).css({position:"absolute",top:"-5000px",left:"-5000px",display:"block"}).appendTo("body");C.ui.cssCache[D]=!!((!/auto|default/.test(E.css("cursor"))||(/^[1-9]/).test(E.css("height"))||(/^[1-9]/).test(E.css("width"))||!(/none/).test(E.css("backgroundImage"))||!(/transparent|rgba\(0, 0, 0, 0\)/).test(E.css("backgroundColor"))));try{C("body").get(0).removeChild(E.get(0))}catch(F){}return C.ui.cssCache[D]},disableSelection:function(D){D.unselectable="on";D.onselectstart=function(){return false};if(D.style){D.style.MozUserSelect="none"}},enableSelection:function(D){D.unselectable="off";D.onselectstart=function(){return true};if(D.style){D.style.MozUserSelect=""}},hasScroll:function(G,E){var D=/top/.test(E||"top")?"scrollTop":"scrollLeft",F=false;if(G[D]>0){return true}G[D]=1;F=G[D]>0?true:false;G[D]=0;return F}});C.each(["Left","Top"],function(E,D){if(!C.fn["scroll"+D]){C.fn["scroll"+D]=function(F){return F!=undefined?this.each(function(){this==window||this==document?window.scrollTo(D=="Left"?F:C(window)["scrollLeft"](),D=="Top"?F:C(window)["scrollTop"]()):this["scroll"+D]=F}):this[0]==window||this[0]==document?self[(D=="Left"?"pageXOffset":"pageYOffset")]||C.boxModel&&document.documentElement["scroll"+D]||document.body["scroll"+D]:this[0]["scroll"+D]}}});var B=C.fn.remove;C.fn.extend({position:function(){var F=this.offset();var E=this.offsetParent();var D=E.offset();return{top:F.top-A(this[0],"marginTop")-D.top-A(E,"borderTopWidth"),left:F.left-A(this[0],"marginLeft")-D.left-A(E,"borderLeftWidth")}},offsetParent:function(){var D=this[0].offsetParent;while(D&&(!/^body|html$/i.test(D.tagName)&&C.css(D,"position")=="static")){D=D.offsetParent}return C(D)},mouseInteraction:function(D){return this.each(function(){new C.ui.mouseInteraction(this,D)})},removeMouseInteraction:function(D){return this.each(function(){if(C.data(this,"ui-mouse")){C.data(this,"ui-mouse").destroy()}})},remove:function(){jQuery("*",this).add(this).trigger("remove");return B.apply(this,arguments)}});function A(D,E){return parseInt(C.curCSS(D.jquery?D[0]:D,E,true))||0}C.ui.mouseInteraction=function(F,E){var D=this;this.element=F;C.data(this.element,"ui-mouse",this);this.options=C.extend({},E);C(F).bind("mousedown.draggable",function(){return D.click.apply(D,arguments)});if(C.browser.msie){C(F).attr("unselectable","on")}C(F).mouseup(function(){if(D.timer){clearInterval(D.timer)}})};C.extend(C.ui.mouseInteraction.prototype,{destroy:function(){C(this.element).unbind("mousedown.draggable")},trigger:function(){return this.click.apply(this,arguments)},click:function(F){if(F.which!=1||C.inArray(F.target.nodeName.toLowerCase(),this.options.dragPrevention||[])!=-1||(this.options.condition&&!this.options.condition.apply(this.options.executor||this,[F,this.element]))){return true}var E=this;var D=function(){E._MP={left:F.pageX,top:F.pageY};C(document).bind("mouseup.draggable",function(){return E.stop.apply(E,arguments)});C(document).bind("mousemove.draggable",function(){return E.drag.apply(E,arguments)});if(!E.initalized&&Math.abs(E._MP.left-F.pageX)>=E.options.distance||Math.abs(E._MP.top-F.pageY)>=E.options.distance){if(E.options.start){E.options.start.call(E.options.executor||E,F,E.element)}if(E.options.drag){E.options.drag.call(E.options.executor||E,F,this.element)}E.initialized=true}};if(this.options.delay){if(this.timer){clearInterval(this.timer)}this.timer=setTimeout(D,this.options.delay)}else{D()}return false},stop:function(D){var E=this.options;if(!this.initialized){return C(document).unbind("mouseup.draggable").unbind("mousemove.draggable")}if(this.options.stop){this.options.stop.call(this.options.executor||this,D,this.element)}C(document).unbind("mouseup.draggable").unbind("mousemove.draggable");this.initialized=false;return false},drag:function(D){var E=this.options;if(C.browser.msie&&!D.button){return this.stop.apply(this,[D])}if(!this.initialized&&(Math.abs(this._MP.left-D.pageX)>=E.distance||Math.abs(this._MP.top-D.pageY)>=E.distance)){if(this.options.start){this.options.start.call(this.options.executor||this,D,this.element)}this.initialized=true}else{if(!this.initialized){return false}}if(E.drag){E.drag.call(this.options.executor||this,D,this.element)}return false}})})(jQuery); ;(function(A){A.fn.extend({draggable:function(C){var B=Array.prototype.slice.call(arguments,1);return this.each(function(){if(typeof C=="string"){var D=A.data(this,"draggable");if(D){D[C].apply(D,B)}}else{if(!A.data(this,"draggable")){new A.ui.draggable(this,C)}}})}});A.ui.draggable=function(D,C){var B=this;this.element=A(D);A.data(D,"draggable",this);this.element.addClass("ui-draggable");this.options=A.extend({},C);var E=this.options;A.extend(E,{helper:E.ghosting==true?"clone":(E.helper||"original"),handle:E.handle?(A(E.handle,D)[0]?A(E.handle,D):this.element):this.element,appendTo:E.appendTo||"parent"});A(D).bind("setData.draggable",function(G,F,H){B.options[F]=H}).bind("getData.draggable",function(G,F){return B.options[F]});A(E.handle).mouseInteraction({executor:this,delay:E.delay,distance:E.distance||1,dragPrevention:E.cancel||E.cancel===""?E.cancel.toLowerCase().split(","):["input","textarea","button","select","option"],start:this.start,stop:this.stop,drag:this.drag,condition:function(F){return !(F.target.className.indexOf("ui-resizable-handle")!=-1||this.options.disabled)}});if(E.helper=="original"&&(this.element.css("position")=="static"||this.element.css("position")=="")){this.element.css("position","relative")}if(E.cursorAt&&E.cursorAt.constructor==Array){E.cursorAt={left:E.cursorAt[0],top:E.cursorAt[1]}}};A.extend(A.ui.draggable.prototype,{plugins:{},ui:function(B){return{helper:this.helper,position:this.position,absolutePosition:this.positionAbs,instance:this,options:this.options,element:this.element}},propagate:function(C,B){A.ui.plugin.call(this,C,[B,this.ui()]);return this.element.triggerHandler(C=="drag"?C:"drag"+C,[B,this.ui()],this.options[C])},destroy:function(){if(!A.data(this.element[0],"draggable")){return }this.options.handle.removeMouseInteraction();this.element.removeClass("ui-draggable ui-draggable-disabled").removeData("draggable").unbind(".draggable")},enable:function(){this.element.removeClass("ui-draggable-disabled");this.options.disabled=false},disable:function(){this.element.addClass("ui-draggable-disabled");this.options.disabled=true},setContrains:function(B,C,E,D){this.minLeft=B;this.maxLeft=C;this.minTop=E;this.maxTop=D;this.constrainsSet=true},checkConstrains:function(){if(!this.constrainsSet){return }if(this.position.left<this.minLeft){this.position.left=this.minLeft}if(this.position.left>this.maxLeft-this.helperProportions.width){this.position.left=this.maxLeft-this.helperProportions.width}if(this.position.top<this.minTop){this.position.top=this.minTop}if(this.position.top>this.maxTop-this.helperProportions.height){this.position.top=this.maxTop-this.helperProportions.height}},recallOffset:function(D){var C={left:this.elementOffset.left-this.offsetParentOffset.left,top:this.elementOffset.top-this.offsetParentOffset.top};var B=this.helper.css("position")=="relative";this.originalPosition={left:(B?parseInt(this.helper.css("left"),10)||0:C.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft)),top:(B?parseInt(this.helper.css("top"),10)||0:C.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop))};this.offset={left:this._pageX-this.originalPosition.left,top:this._pageY-this.originalPosition.top}},start:function(D){var E=this.options;if(A.ui.ddmanager){A.ui.ddmanager.current=this}this.helper=typeof E.helper=="function"?A(E.helper.apply(this.element[0],[D])):(E.helper=="clone"?this.element.clone().appendTo((E.appendTo=="parent"?this.element[0].parentNode:E.appendTo)):this.element);if(this.helper[0]!=this.element[0]){this.helper.css("position","absolute")}if(!this.helper.parents("body").length){this.helper.appendTo((E.appendTo=="parent"?this.element[0].parentNode:E.appendTo))}this.offsetParent=(function(F){while(F){if(F.style&&(/(absolute|relative|fixed)/).test(A.css(F,"position"))){return A(F)}F=F.parentNode?F.parentNode:null}return A("body")})(this.helper[0].parentNode);this.elementOffset=this.element.offset();this.offsetParentOffset=this.offsetParent.offset();var C={left:this.elementOffset.left-this.offsetParentOffset.left,top:this.elementOffset.top-this.offsetParentOffset.top};this._pageX=D.pageX;this._pageY=D.pageY;this.clickOffset={left:D.pageX-this.elementOffset.left,top:D.pageY-this.elementOffset.top};var B=this.helper.css("position")=="relative";this.originalPosition={left:(B?parseInt(this.helper.css("left"),10)||0:C.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft)),top:(B?parseInt(this.helper.css("top"),10)||0:C.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop))};if(this.element.css("position")=="fixed"){this.originalPosition.top-=this.offsetParent[0]==document.body?A(document).scrollTop():this.offsetParent[0].scrollTop;this.originalPosition.left-=this.offsetParent[0]==document.body?A(document).scrollLeft():this.offsetParent[0].scrollLeft}this.offset={left:D.pageX-this.originalPosition.left,top:D.pageY-this.originalPosition.top};if(this.element[0]!=this.helper[0]){this.offset.left+=parseInt(this.element.css("marginLeft"),10)||0;this.offset.top+=parseInt(this.element.css("marginTop"),10)||0}this.propagate("start",D);this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};if(A.ui.ddmanager&&!E.dropBehaviour){A.ui.ddmanager.prepareOffsets(this,D)}if(E.cursorAt){if(E.cursorAt.top!=undefined||E.cursorAt.bottom!=undefined){this.offset.top-=this.clickOffset.top-(E.cursorAt.top!=undefined?E.cursorAt.top:(this.helperProportions.height-E.cursorAt.bottom));this.clickOffset.top=(E.cursorAt.top!=undefined?E.cursorAt.top:(this.helperProportions.height-E.cursorAt.bottom))}if(E.cursorAt.left!=undefined||E.cursorAt.right!=undefined){this.offset.left-=this.clickOffset.left-(E.cursorAt.left!=undefined?E.cursorAt.left:(this.helperProportions.width-E.cursorAt.right));this.clickOffset.left=(E.cursorAt.left!=undefined?E.cursorAt.left:(this.helperProportions.width-E.cursorAt.right))}}return false},clear:function(){if(A.ui.ddmanager){A.ui.ddmanager.current=null}this.helper=null},stop:function(B){if(A.ui.ddmanager&&!this.options.dropBehaviour){A.ui.ddmanager.drop(this,B)}this.propagate("stop",B);if(this.cancelHelperRemoval){return false}if(this.options.helper!="original"){this.helper.remove()}this.clear();return false},drag:function(B){this.position={top:B.pageY-this.offset.top,left:B.pageX-this.offset.left};this.positionAbs={left:B.pageX-this.clickOffset.left,top:B.pageY-this.clickOffset.top};this.checkConstrains();this.position=this.propagate("drag",B)||this.position;this.checkConstrains();A(this.helper).css({left:this.position.left+"px",top:this.position.top+"px"});if(A.ui.ddmanager){A.ui.ddmanager.drag(this,B)}return false}});A.ui.plugin.add("draggable","cursor",{start:function(D,C){var B=A("body");if(B.css("cursor")){C.options._cursor=B.css("cursor")}B.css("cursor",C.options.cursor)},stop:function(C,B){if(B.options._cursor){A("body").css("cursor",B.options._cursor)}}});A.ui.plugin.add("draggable","zIndex",{start:function(D,C){var B=A(C.helper);if(B.css("zIndex")){C.options._zIndex=B.css("zIndex")}B.css("zIndex",C.options.zIndex)},stop:function(C,B){if(B.options._zIndex){A(B.helper).css("zIndex",B.options._zIndex)}}});A.ui.plugin.add("draggable","opacity",{start:function(D,C){var B=A(C.helper);if(B.css("opacity")){C.options._opacity=B.css("opacity")}B.css("opacity",C.options.opacity)},stop:function(C,B){if(B.options._opacity){A(B.helper).css("opacity",B.options._opacity)}}});A.ui.plugin.add("draggable","revert",{stop:function(E,D){var B=D.instance,C=A(B.helper);B.cancelHelperRemoval=true;A(D.helper).animate({left:B.originalPosition.left,top:B.originalPosition.top},parseInt(D.options.revert,10)||500,function(){if(D.options.helper!="original"){C.remove()}if(!C){B.clear()}})}});A.ui.plugin.add("draggable","iframeFix",{start:function(D,C){var F=C.options;if(C.instance.slowMode){return }if(F.iframeFix.constructor==Array){for(var B=0;B<F.iframeFix.length;B++){var E=A(F.iframeFix[B]).offset({border:false});A('<div class="DragDropIframeFix"" style="background: #fff;"></div>').css("width",A(F.iframeFix[B])[0].offsetWidth+"px").css("height",A(F.iframeFix[B])[0].offsetHeight+"px").css("position","absolute").css("opacity","0.001").css("z-index","1000").css("top",E.top+"px").css("left",E.left+"px").appendTo("body")}}else{A("iframe").each(function(){var G=A(this).offset({border:false});A('<div class="DragDropIframeFix" style="background: #fff;"></div>').css("width",this.offsetWidth+"px").css("height",this.offsetHeight+"px").css("position","absolute").css("opacity","0.001").css("z-index","1000").css("top",G.top+"px").css("left",G.left+"px").appendTo("body")})}},stop:function(C,B){if(B.options.iframeFix){A("div.DragDropIframeFix").each(function(){this.parentNode.removeChild(this)})}}});A.ui.plugin.add("draggable","containment",{start:function(E,C){var G=C.options;var B=C.instance;if((G.containment.left!=undefined||G.containment.constructor==Array)&&!G._containment){return }if(!G._containment){G._containment=G.containment}if(G._containment=="parent"){G._containment=this[0].parentNode}if(G._containment=="document"){G.containment=[0,0,A(document).width(),(A(document).height()||document.body.parentNode.scrollHeight)]}else{var D=A(G._containment)[0];var F=A(G._containment).offset();G.containment=[F.left,F.top,F.left+(D.offsetWidth||D.scrollWidth),F.top+(D.offsetHeight||D.scrollHeight)]}var H=G.containment;C.instance.setContrains(H[0]-(B.offset.left-B.clickOffset.left),H[2]-(B.offset.left-B.clickOffset.left),H[1]-(B.offset.top-B.clickOffset.top),H[3]-(B.offset.top-B.clickOffset.top))}});A.ui.plugin.add("draggable","grid",{drag:function(E,D){var F=D.options;var C=D.instance.originalPosition.left+Math.round((E.pageX-D.instance._pageX)/F.grid[0])*F.grid[0];var B=D.instance.originalPosition.top+Math.round((E.pageY-D.instance._pageY)/F.grid[1])*F.grid[1];D.instance.position.left=C;D.instance.position.top=B}});A.ui.plugin.add("draggable","axis",{drag:function(C,B){var D=B.options;if(D.constraint){D.axis=D.constraint}switch(D.axis){case"x":B.instance.position.top=B.instance.originalPosition.top;break;case"y":B.instance.position.left=B.instance.originalPosition.left;break}}});A.ui.plugin.add("draggable","scroll",{start:function(C,B){var D=B.options;D.scrollSensitivity=D.scrollSensitivity||20;D.scrollSpeed=D.scrollSpeed||20;B.instance.overflowY=function(E){do{if(/auto|scroll/.test(E.css("overflow"))||(/auto|scroll/).test(E.css("overflow-y"))){return E}E=E.parent()}while(E[0].parentNode);return A(document)}(this);B.instance.overflowX=function(E){do{if(/auto|scroll/.test(E.css("overflow"))||(/auto|scroll/).test(E.css("overflow-x"))){return E}E=E.parent()}while(E[0].parentNode);return A(document)}(this)},drag:function(D,C){var E=C.options;var B=C.instance;if(B.overflowY[0]!=document&&B.overflowY[0].tagName!="HTML"){if(B.overflowY[0].offsetHeight-(C.position.top-B.overflowY[0].scrollTop+B.clickOffset.top)<E.scrollSensitivity){B.overflowY[0].scrollTop=B.overflowY[0].scrollTop+E.scrollSpeed}if((C.position.top-B.overflowY[0].scrollTop+B.clickOffset.top)<E.scrollSensitivity){B.overflowY[0].scrollTop=B.overflowY[0].scrollTop-E.scrollSpeed}}else{if(D.pageY-A(document).scrollTop()<E.scrollSensitivity){A(document).scrollTop(A(document).scrollTop()-E.scrollSpeed)}if(A(window).height()-(D.pageY-A(document).scrollTop())<E.scrollSensitivity){A(document).scrollTop(A(document).scrollTop()+E.scrollSpeed)}}if(B.overflowX[0]!=document&&B.overflowX[0].tagName!="HTML"){if(B.overflowX[0].offsetWidth-(C.position.left-B.overflowX[0].scrollLeft+B.clickOffset.left)<E.scrollSensitivity){B.overflowX[0].scrollLeft=B.overflowX[0].scrollLeft+E.scrollSpeed}if((C.position.top-B.overflowX[0].scrollLeft+B.clickOffset.left)<E.scrollSensitivity){B.overflowX[0].scrollLeft=B.overflowX[0].scrollLeft-E.scrollSpeed}}else{if(D.pageX-A(document).scrollLeft()<E.scrollSensitivity){A(document).scrollLeft(A(document).scrollLeft()-E.scrollSpeed)}if(A(window).width()-(D.pageX-A(document).scrollLeft())<E.scrollSensitivity){A(document).scrollLeft(A(document).scrollLeft()+E.scrollSpeed)}}C.instance.recallOffset(D)}});A.ui.plugin.add("draggable","snap",{start:function(C,B){B.instance.snapElements=[];A(B.options.snap===true?".ui-draggable":B.options.snap).each(function(){var E=A(this);var D=E.offset();if(this!=B.instance.element[0]){B.instance.snapElements.push({item:this,width:E.outerWidth(),height:E.outerHeight(),top:D.top,left:D.left})}})},drag:function(I,M){var K=M.options.snapTolerance||20;var D=M.absolutePosition.left,C=D+M.instance.helperProportions.width,O=M.absolutePosition.top,N=O+M.instance.helperProportions.height;for(var H=M.instance.snapElements.length-1;H>=0;H--){var E=M.instance.snapElements[H].left,B=E+M.instance.snapElements[H].width,Q=M.instance.snapElements[H].top,L=Q+M.instance.snapElements[H].height;if(!((E-K<D&&D<B+K&&Q-K<O&&O<L+K)||(E-K<D&&D<B+K&&Q-K<N&&N<L+K)||(E-K<C&&C<B+K&&Q-K<O&&O<L+K)||(E-K<C&&C<B+K&&Q-K<N&&N<L+K))){continue}if(M.options.snapMode!="inner"){var J=Math.abs(Q-N)<=20;var P=Math.abs(L-O)<=20;var G=Math.abs(E-C)<=20;var F=Math.abs(B-D)<=20;if(J){M.position.top=Q-M.instance.offset.top+M.instance.clickOffset.top-M.instance.helperProportions.height}if(P){M.position.top=L-M.instance.offset.top+M.instance.clickOffset.top}if(G){M.position.left=E-M.instance.offset.left+M.instance.clickOffset.left-M.instance.helperProportions.width}if(F){M.position.left=B-M.instance.offset.left+M.instance.clickOffset.left}}if(M.options.snapMode!="outer"){var J=Math.abs(Q-O)<=20;var P=Math.abs(L-N)<=20;var G=Math.abs(E-D)<=20;var F=Math.abs(B-C)<=20;if(J){M.position.top=Q-M.instance.offset.top+M.instance.clickOffset.top}if(P){M.position.top=L-M.instance.offset.top+M.instance.clickOffset.top-M.instance.helperProportions.height}if(G){M.position.left=E-M.instance.offset.left+M.instance.clickOffset.left}if(F){M.position.left=B-M.instance.offset.left+M.instance.clickOffset.left-M.instance.helperProportions.width}}}}});A.ui.plugin.add("draggable","connectToSortable",{start:function(C,B){B.instance.sortable=A.data(A(B.options.connectToSortable)[0],"sortable");B.instance.sortableOffset=B.instance.sortable.element.offset();B.instance.sortableOuterWidth=B.instance.sortable.element.outerWidth();B.instance.sortableOuterHeight=B.instance.sortable.element.outerHeight();if(B.instance.sortable.options.revert){B.instance.sortable.shouldRevert=true}},stop:function(D,C){var B=C.instance.sortable;if(B.isOver){B.isOver=0;C.instance.cancelHelperRemoval=true;B.cancelHelperRemoval=false;if(B.shouldRevert){B.options.revert=true}B.stop(D);B.options.helper="original"}},drag:function(F,E){var D=E.instance.sortable;E.instance.position.absolute=E.absolutePosition;if(D.intersectsWith.call(E.instance,{left:E.instance.sortableOffset.left,top:E.instance.sortableOffset.top,width:E.instance.sortableOuterWidth,height:E.instance.sortableOuterHeight})){if(!D.isOver){D.isOver=1;var B=D.options.placeholderElement?A(D.options.placeholderElement,A(D.options.items,D.element)).innerHeight():A(D.options.items,D.element).innerHeight();var C=D.options.placeholderElement?A(D.options.placeholderElement,A(D.options.items,D.element)).innerWidth():A(D.options.items,D.element).innerWidth();D.currentItem=A(this).clone().appendTo(D.element);D.options.helper=function(){return E.helper[0]};D.start(F);D.clickOffset.top=E.instance.clickOffset.top;D.clickOffset.left=E.instance.clickOffset.left;D.offset.left-=E.absolutePosition.left-D.position.absolute.left;D.offset.top-=E.absolutePosition.top-D.position.absolute.top;D.helperProportions={width:C,height:B};E.helper.animate({height:B,width:C},500);E.instance.propagate("toSortable",F)}if(D.currentItem){D.drag(F)}}else{if(D.isOver){D.isOver=0;D.cancelHelperRemoval=true;D.options.revert=false;D.stop(F);D.options.helper="original";D.currentItem.remove();D.placeholder.remove();E.helper.animate({height:this.innerHeight(),width:this.innerWidth()},500);E.instance.propagate("fromSortable",F)}}}})})(jQuery); ;var modal_scroller=true;var modal_status=true;function modal_bg() {if(!modal_status)return false;modal_status=false;$('body').addClass('noscroll').append('<div class="module"><div class="modal_mask"></div><div class="modal_scroller"><div class="modal_container"></div></div></div>');$('.module .modal_mask').css("opacity","0.5");} function modal_remove(){modal_status=true;$('.module').remove();$('body').removeClass('noscroll');} function modal_add(){var modal_container=$('.module .modal_container');var modal_content=modal_container.children().eq(0);var modal_content_width=modal_content.outerWidth(true);var modal_content_height=modal_content.outerHeight(true);var window_width=$(window).outerWidth(true);var window_height=$(window).outerHeight(true);var sum=50;modal_content.css({margin:'0 auto'});if(modal_content_height>=window_height-sum) {modal_container.css({marginTop:sum+'px'});} else {if((window_height-modal_content_height)/2<=sum) {modal_container.css({marginTop:sum+'px'});} else {modal_container.css({marginTop:(window_height-modal_content_height)/2+'px'});}} modal_content.hover(function(){modal_scroller=false;},function(){modal_scroller=true;});modal_content.find("select").click(function(){modal_scroller=false;});$('.modal_scroller').click(function(){if(modal_scroller) {modal_remove();}});} $(window).resize(function(){modal_add()});